datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
  output          = "../gen/prisma"
}

enum EventStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Event {
  id               Int         @id @default(autoincrement())
  externalId       String?     @unique @map("external_id")
  title            String
  status           EventStatus @default(DRAFT) @map("status")
  startDateTime    DateTime    @map("start_date_time") @db.Timestamptz(3)
  endDateTime      DateTime    @map("end_date_time") @db.Timestamptz(3)
  isFullDay        Boolean     @default(false) @map("is_full_day")
  timeZone         String      @default("Europe/Amsterdam") @map("time_zone")
  venueId          Int?        @map("venue_id")
  organizerId      Int?        @map("organizer_id")
  featured         Boolean?    @default(false) @map("featured")
  featuredText     String?     @map("featured_text")
  featuredImageRef String?     @map("featured_image_ref")
  remarks          String?     @map("remarks")
  link             String?     @map("link")
  createdAt        DateTime    @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime    @updatedAt @map("updated_at") @db.Timestamptz(3)

  venue     Venue?     @relation(fields: [venueId], references: [id])
  organizer Organizer? @relation(fields: [organizerId], references: [id])
  tags      EventTag[]

  @@map("events")
}

model Tag {
  id   Int    @id @default(autoincrement())
  name String @unique

  events EventTag[]

  @@map("tags")
}

model EventTag {
  eventId Int @map("event_id")
  tagId   Int @map("tag_id")

  event Event @relation(fields: [eventId], references: [id])
  tag   Tag   @relation(fields: [tagId], references: [id])

  @@unique([eventId, tagId])
  @@map("event_tags")
}

model Organizer {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  imageRef  String?  @map("image_ref")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)

  events Event[]

  @@map("organizers")
}

model Venue {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  imageRef   String?  @map("image_ref")
  lat        Float?
  long       Float?
  address    String?  @map("address")
  postalCode String?  @map("postal_code")
  city       String?
  country    String?
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)

  events Event[]

  @@map("venues")
}

enum ActionType {
  PUBLISH
  BOULDERBOT

  @@map("action_type")
}

model Action {
  id        Int        @id @default(autoincrement())
  type      ActionType @map("type")
  userEmail String     @map("user_email")
  start     DateTime   @default(now()) @db.Timestamptz(3)
  end       DateTime?  @db.Timestamptz(3)
  resultOk  Boolean?   @map("result_ok")
  details   String?

  @@map("actions")
}

model ActionLog {
  id         Int      @id @default(autoincrement())
  actionId   Int      @map("action_id")
  level      String   @default("info") @map("level")
  actionType String   @map("action_type")
  datetime   DateTime @default(now()) @db.Timestamptz(3)
  data       String

  @@map("action_logs")
}

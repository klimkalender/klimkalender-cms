datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
  output          = "../gen/prisma"
}

enum EventStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Event {
  id               Int         @id @default(autoincrement())
  externalId       String?     @unique @map("external_id")
  title            String
  status           EventStatus @default(DRAFT) @map("status")
  startDateTime    DateTime    @map("start_date_time") @db.Timestamptz(3)
  endDateTime      DateTime    @map("end_date_time") @db.Timestamptz(3)
  isFullDay        Boolean     @default(false) @map("is_full_day")
  timeZone         String      @default("Europe/Amsterdam") @map("time_zone")
  venueId          Int?        @map("venue_id")
  organizerId      Int?        @map("organizer_id")
  featured         Boolean?    @default(false) @map("featured")
  featuredText     String?     @map("featured_text")
  featuredImageRef String?     @map("featured_image_ref")
  remarks          String?     @map("remarks")
  link             String?     @map("link")
  createdBy        String?     @map("created_by") @db.Uuid
  updatedBy        String?     @map("updated_by") @db.Uuid
  createdAt        DateTime    @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime    @updatedAt @map("updated_at") @db.Timestamptz(3)

  venue     Venue?     @relation(fields: [venueId], references: [id])
  organizer Organizer? @relation(fields: [organizerId], references: [id])
  tags      EventTag[]
  WasmEvent WasmEvent?

  @@map("events")
}

model Tag {
  id        Int     @id @default(autoincrement())
  name      String  @unique
  createdBy String? @map("created_by") @db.Uuid
  updatedBy String? @map("updated_by") @db.Uuid

  events EventTag[]

  @@map("tags")
}

model EventTag {
  eventId Int @map("event_id")
  tagId   Int @map("tag_id")

  event Event @relation(fields: [eventId], references: [id])
  tag   Tag   @relation(fields: [tagId], references: [id])

  @@unique([eventId, tagId])
  @@map("event_tags")
}

model Organizer {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  imageRef  String?  @map("image_ref")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)
  createdBy String?  @map("created_by") @db.Uuid
  updatedBy String?  @map("updated_by") @db.Uuid

  events Event[]

  @@map("organizers")
}

model Venue {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  imageRef   String?  @map("image_ref")
  lat        Float?
  long       Float?
  address    String?  @map("address")
  postalCode String?  @map("postal_code")
  city       String?
  country    String?
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)
  createdBy  String?  @map("created_by") @db.Uuid
  updatedBy  String?  @map("updated_by") @db.Uuid

  events Event[]

  @@map("venues")
}

enum ActionType {
  PUBLISH
  BOULDERBOT

  @@map("action_type")
}

model Action {
  id        Int        @id @default(autoincrement())
  type      ActionType @map("type")
  userEmail String     @map("user_email")
  start     DateTime   @default(now()) @db.Timestamptz(3)
  end       DateTime?  @db.Timestamptz(3)
  resultOk  Boolean?   @map("result_ok")
  details   String?

  @@map("actions")
}

model ActionLog {
  id         Int      @id @default(autoincrement())
  actionId   Int      @map("action_id")
  level      String   @default("info") @map("level")
  actionType String   @map("action_type")
  datetime   DateTime @default(now()) @db.Timestamptz(3)
  data       String

  @@map("action_logs")
}

enum WasmEventClassification {
  UNKNOWN
  COMPETITION
  NOCOMPETITION

  @@map("wasm_event_classification")
}

enum WasmEventCategory {
  OTHER
  BOULDER
  LEAD

  @@map("wasm_event_category")
}

enum WasmAction {
  MANUAL_IMPORT
  AUTO_IMPORT

  @@map("wasm_action")
}

enum WasmEventStatus {
  NEW
  IGNORED
  UP_TO_DATE
  CHANGED
  REMOVED
  EVENT_PASSED

  @@map("wasm_event_status")
}

model WasmEvent {
  id                          Int                      @id @default(autoincrement())
  externalId                  String                   @unique @map("external_id")
  hallName                    String?                  @map("hall_name")
  name                        String                   @map("name")
  date                        DateTime                 @map("date") @db.Timestamptz(3)
  imageUrl                    String?                  @map("image_url")
  shortDescription            String?                  @map("short_description")
  fullDescriptionHtml         String?                  @map("full_description_html")
  eventUrl                    String?                  @map("event_url")
  classification              WasmEventClassification  @map("classification")
  eventCategory               WasmEventCategory        @map("event_category")
  acceptedHallName            String?                  @map("accepted_hall_name")
  acceptedName                String?                  @map("accepted_name")
  acceptedDate                DateTime?                @map("accepted_date") @db.Timestamptz(3)
  acceptedImageUrl            String?                  @map("accepted_image_url")
  acceptedShortDescription    String?                  @map("accepted_short_description")
  acceptedFullDescriptionHtml String?                  @map("accepted_full_description_html")
  acceptedEventUrl            String?                  @map("accepted_event_url")
  acceptedClassification      WasmEventClassification? @map("accepted_classification")
  acceptedEventCategory       WasmEventCategory?       @map("accepted_event_category")
  eventId                     Int?                     @unique @map("event_id")
  event                       Event?                   @relation(fields: [eventId], references: [id], onDelete: SetNull)
  processedAt                 DateTime?                @map("processed_at") @db.Timestamptz(3)
  status                      WasmEventStatus          @default(NEW) @map("status")
  action                      WasmAction?              @map("action")
  createdAt                   DateTime                 @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt                   DateTime?                @map("updated_at") @db.Timestamptz(3)
  createdBy                   String?                  @map("created_by") @db.Uuid
  updatedBy                   String?                  @map("updated_by") @db.Uuid

  @@map("wasm_events")
}
